<!doctype html>
<html lang="en" dir="ltr">
<head>
	
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	
	<title></title>
	<meta name="description" content="">
	<meta name="keywords" content="">
	
	<style>
		
		* {
			-webkit-box-sizing: border-box;
			   -moz-box-sizing: border-box;
			        box-sizing: border-box;
		}
		
		.data {
			position: relative;
			max-width: 300px;
			border-width: 1px;
			border-style: solid;
			border-color: #ccc;
			margin: 20px auto;
			padding: 20px;
			border-radius: 3px;
		}
		.data .data-bar {
			background: #ccc;
			width: 0;
			height: 20px;
			border-radius: 3px;
			display: block;
			-webkit-transition: width 0.4s;
			   -moz-transition: width 0.4s;
			     -o-transition: width 0.4s;
			        transition: width 0.4s;
		}
		.data .data-loader {
			background-image: url(loader1.gif);
			background-repeat: no-repeat;
			width: 25px;
			height: 25px;
			background-size: cover;
			position: absolute;
			top: 5px;
			right: 5px;
		}
		
		.data.data-reverse {
			color: #eee;
			background: #333;
			border-color: #000;
		}
		.data.data-reverse .data-bar { background: #999; }
		.data.data-reverse .data-loader { background-image: url(loader2.gif); }
		
	</style>
	
</head>
<body>
	
	<div id="mod1" class="data"></div>
	
	<div id="mod2" class="data data-reverse"></div>
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="../pollster/jquery.pollster.min.js"></script>
	<script>
		
		$(document).ready(function() {
			
			//----------------------------------------------------------------------
			
			var $loading = $('<span />', {
				'class': 'data-loader'
			})
				.hide()
				.appendTo('.data');
			
			//----------------------------------------------------------------------
			
			// Global plugin defaults:
			$.pollster.defaults.type = 'json';
			$.pollster.defaults.loader = 'data-loader';
			$.pollster.defaults.api = function() {
				return ('test' + ((Math.random() * 2 | 0) + 1) + '.json');
			};
			
			//----------------------------------------------------------------------
			
				$.pollster({
					target: 'mod1',
					callback: function($data, $options) {
						
						var $this = $(this);
						var template;
						var percent = $data[0].options[0].percent + '%';
						
						console.log($this, $options.count);
						
						if ($options.first) {
							
							template = [
								'<div></div>',
								'<span class="data-bar"></span>'
							].join('\n');
							
							$this.append(template);
							
						}
						
						$this
							.children('div')
								.html($data[0].title + ' ' + percent);
						
						$this
							.children('.data-bar')
								.width(percent);
						
					}
				});
			
			//----------------------------------------------------------------------
			
			$.pollster({
				target: 'mod2',
				seconds: 5,
				params: 'subcats=' + encodeURIComponent('elections oregon results'),
				//type: 'jsonp',
				callback: function($data, $options) {
					
					var $this = $(this);
					var template;
					var percent = $data[0].options[0].percent + '%';
					
					console.log($this, $options.count);
					
					if ($options.first) {
						
						template = [
							'<div></div>',
							'<span class="data-bar"></span>'
						].join('\n');
						
						$this.append(template);
						
					}
					
					$this
						.find('div')
							.html($data[0].title + ' ' + percent);
					
					$this
						.find('.data-bar')
							.width(percent);
					
				}
			});
			
			//----------------------------------------------------------------------
			
		});
		
	</script>
	
</body>
</html>
